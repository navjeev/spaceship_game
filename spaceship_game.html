<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro-Futuristic Spaceship Battle</title>
    <style>
        body {
            margin: 0;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            color: white;
            font-family: "Roboto", sans-serif;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border: 2px solid #00ff99;
            border-radius: 10px;
            background: radial-gradient(circle, #001f33, #000);
            box-shadow: 0 4px 20px rgba(0, 255, 153, 0.5);
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
        }

        #timer {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
        }

        #game-over, #level-complete, #game-instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 36px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.4);
            color: #fff;
            display: none;
        }

        #game-over button, #level-complete button, #game-instructions button {
            background: #00ff99;
            color: black;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px;
            transition: background 0.3s;
        }

        #game-over button:hover, #level-complete button:hover, #game-instructions button:hover {
            background: #00cc77;
        }

        #persona-selection {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.4);
            color: #fff;
        }

        #persona-selection button {
            background: #00ff99;
            color: black;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px;
            transition: background 0.3s;
        }

        #persona-selection button:hover {
            background: #00cc77;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="persona-selection">
        <p style="font-size: 28px;">Choose Your Persona</p>
        <button onclick="selectPersona('Kate')">Play as Kate</button>
        <button onclick="selectPersona('Nav')">Play as Nav</button>
    </div>
    <div id="game-instructions">
        <p style="font-size: 28px;">Welcome to the Game!</p>
        <p>Use the arrow keys to move and the spacebar to shoot.</p>
        <p>Destroy enemies to score points. Reach 50 points to advance to the next level.</p>
        <p>Can you complete all 5 levels?</p>
        <button onclick="startGame()">Start Game</button>
    </div>
    <div id="level-complete">
        <p style="font-size: 28px;">Level Complete!</p>
        <p>Get ready for the next round!</p>
        <button onclick="startNextLevel()">Continue</button>
    </div>
    <div id="score" style="display:none;">Score: 0</div>
    <div id="timer" style="display:none;">Time: 0s</div>
    <div id="game-over">
        <p style="font-size: 32px;">Game Over!</p>
        <p>Your final score: <span id="final-score">0</span></p>
        <p>Total time: <span id="final-time">0s</span></p>
        <button onclick="restartGame()">Play Again</button>
        <button onclick="takeScreenshot()">Take Screenshot</button>
    </div>
    <canvas id="gameCanvas" width="800" height="600" style="display:none;"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDisplay = document.getElementById("score");
        const timerDisplay = document.getElementById("timer");
        const gameOverDisplay = document.getElementById("game-over");
        const levelCompleteDisplay = document.getElementById("level-complete");
        const gameInstructions = document.getElementById("game-instructions");
        const finalScoreDisplay = document.getElementById("final-score");
        const finalTimeDisplay = document.getElementById("final-time");
        const personaSelection = document.getElementById("persona-selection");

        let persona = null;
        let score = 0;
        let level = 1;
        let startTime = 0;
        let timerInterval;
        const maxLevel = 5;
        let gameRunning = false;
        const spaceship = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 40,
            height: 20,
            speed: 12
        };
        const bullets = [];
        const enemies = [];

        const stars = Array.from({ length: 100 }, () => ({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 2
        }));

        function drawStars() {
            ctx.fillStyle = "white";
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
                star.y += 0.5;
                if (star.y > canvas.height) star.y = 0;
            });
        }

        function drawSpaceship() {
            ctx.fillStyle = persona === "Kate" ? "#ff66ff" : "#6699ff";
            ctx.fillRect(spaceship.x, spaceship.y, spaceship.width, spaceship.height);
            ctx.shadowBlur = 10;
            ctx.shadowColor = persona === "Kate" ? "#ff66ff" : "#6699ff";
        }

        function drawBullet(bullet) {
            ctx.fillStyle = "#00ff99";
            ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
        }

        function drawEnemy(enemy) {
            ctx.fillStyle = "#00ff99";
            ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
        }

        function spawnEnemy() {
            const enemy = {
                x: Math.random() * (canvas.width - 40),
                y: -20,
                width: 40,
                height: 20,
                speed: level === 5 && persona === "Kate" ? 8 : 2 + level * 0.5 + Math.random() * 3
            };
            enemies.push(enemy);
        }

        function levelUp() {
            if (score >= 50 * level && level < maxLevel) {
                level++;
                scoreDisplay.style.display = "none";
                timerDisplay.style.display = "none";
                gameRunning = false;
                clearInterval(timerInterval);
                levelCompleteDisplay.style.display = "block";
            } else if (level === maxLevel && score >= 50 * level) {
                winGame();
            }
        }

        function winGame() {
            gameRunning = false;
            clearInterval(timerInterval);
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            gameOverDisplay.style.display = "block";
            gameOverDisplay.querySelector("p").textContent = `Congratulations ${persona}! You Win!`;
            finalScoreDisplay.textContent = score;
            finalTimeDisplay.textContent = `${elapsedTime}s`;
        }

        function update() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawStars();
            drawSpaceship();

            bullets.forEach((bullet, index) => {
                bullet.y -= 7;
                if (bullet.y + bullet.height < 0) {
                    bullets.splice(index, 1);
                } else {
                    drawBullet(bullet);
                }
            });

            enemies.forEach((enemy, index) => {
                enemy.y += enemy.speed;
                if (
                    enemy.x < spaceship.x + spaceship.width &&
                    enemy.x + enemy.width > spaceship.x &&
                    enemy.y < spaceship.y + spaceship.height &&
                    enemy.y + enemy.height > spaceship.y
                ) {
                    endGame();
                }

                if (enemy.y > canvas.height) {
                    enemies.splice(index, 1);
                } else {
                    drawEnemy(enemy);
                }
            });

            bullets.forEach((bullet, bIndex) => {
                enemies.forEach((enemy, eIndex) => {
                    if (
                        bullet.x < enemy.x + enemy.width &&
                        bullet.x + bullet.width > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + bullet.height > enemy.y
                    ) {
                        bullets.splice(bIndex, 1);
                        enemies.splice(eIndex, 1);
                        score += 10;
                        scoreDisplay.textContent = `Score: ${score} | Level: ${level}`;
                        levelUp();
                    }
                });
            });

            requestAnimationFrame(update);
        }

        function endGame() {
            gameRunning = false;
            clearInterval(timerInterval);
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            gameOverDisplay.style.display = "block";
            finalScoreDisplay.textContent = score;
            finalTimeDisplay.textContent = `${elapsedTime}s`;
        }

        function restartGame() {
            score = 0;
            level = 1;
            scoreDisplay.textContent = "Score: 0 | Level: 1";
            enemies.length = 0;
            bullets.length = 0;
            spaceship.x = canvas.width / 2;
            startTime = Date.now();
            timerDisplay.textContent = "Time: 0s";
            timerInterval = setInterval(() => {
                const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                timerDisplay.textContent = `Time: ${elapsedTime}s`;
            }, 1000);
            gameRunning = true;
            gameOverDisplay.style.display = "none";
            update();
        }

        function startGame() {
            gameInstructions.style.display = "none";
            canvas.style.display = "block";
            scoreDisplay.style.display = "block";
            timerDisplay.style.display = "block";
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                timerDisplay.textContent = `Time: ${elapsedTime}s`;
            }, 1000);
            gameRunning = true;
            update();
        }

        function startNextLevel() {
            levelCompleteDisplay.style.display = "none";
            scoreDisplay.style.display = "block";
            timerDisplay.style.display = "block";
            gameRunning = true;
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                timerDisplay.textContent = `Time: ${elapsedTime}s`;
            }, 1000);
            update();
        }

        function selectPersona(selectedPersona) {
            persona = selectedPersona;
            personaSelection.style.display = "none";
            gameInstructions.style.display = "block";
        }

        function takeScreenshot() {
            const link = document.createElement('a');
            link.download = `${persona}_level5_win.png`;
            canvas.toBlob((blob) => {
                link.href = URL.createObjectURL(blob);
                link.click();
            });
        }

        document.addEventListener("keydown", (e) => {
            if (!gameRunning) return;

            if (e.key === "ArrowLeft" && spaceship.x > 0) {
                spaceship.x -= spaceship.speed;
            }

            if (e.key === "ArrowRight" && spaceship.x + spaceship.width < canvas.width) {
                spaceship.x += spaceship.speed;
            }

            if (e.key === " " || e.key === "Spacebar") {
                bullets.push({
                    x: spaceship.x + spaceship.width / 2 - 5,
                    y: spaceship.y,
                    width: 5,
                    height: 10
                });
            }
        });

        setInterval(spawnEnemy, 1000);
    </script>
</body>
</html>
